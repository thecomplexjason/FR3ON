local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlotsFolder = workspace:WaitForChild("Plots")

local playerDisplayName = LocalPlayer and LocalPlayer.DisplayName or "Unknown"
local ESPs = {}

for _, model in ipairs(PlotsFolder:GetChildren()) do
	if model:IsA("Model") then
		local plotSign = model:FindFirstChild("PlotSign")

		if plotSign and plotSign:IsA("BasePart") then
			local surfaceGui = plotSign:FindFirstChildWhichIsA("SurfaceGui")
			if surfaceGui then
				local frame = surfaceGui:FindFirstChildWhichIsA("Frame")
				if frame then
					local textLabel = frame:FindFirstChildWhichIsA("TextLabel")
					if textLabel then
						-- Create invisible part above model
						local part = Instance.new("Part")
						part.Anchored = true
						part.CanCollide = false
						part.Transparency = 1
						part.Size = Vector3.new(0.5, 0.5, 0.5)
						part.Position = model:GetModelCFrame().p + Vector3.new(0, 6, 0)
						part.Name = "ESP_Part_" .. model.Name
						part.Parent = workspace

						-- BillboardGui setup
						local billboard = Instance.new("BillboardGui")
						billboard.Size = UDim2.new(0, 150, 0, 30)
						billboard.StudsOffset = Vector3.new(0, 1.5, 0)
						billboard.AlwaysOnTop = true
						billboard.Adornee = part
						billboard.Name = "ESP_Billboard_" .. model.Name
						billboard.Parent = part

						-- TextLabel inside BillboardGui
						local label = Instance.new("TextLabel")
						label.Size = UDim2.new(1, 0, 1, 0)
						label.BackgroundTransparency = 1
						label.TextColor3 = Color3.new(1, 1, 1)
						label.TextStrokeColor3 = Color3.new(0, 0, 0)
						label.TextStrokeTransparency = 0.2
						label.TextScaled = true
						label.Font = Enum.Font.GothamBold
						label.Text = ""
						label.Parent = billboard

						-- Store references for update
						table.insert(ESPs, {
							textLabel = textLabel,
							label = label
						})
					end
				end
			end
		end
	end
end

-- Update ESP text every 0.5 seconds
while true do
	for _, esp in ipairs(ESPs) do
		if esp.textLabel and esp.label then
			local originalText = esp.textLabel.Text

			if originalText == "Empty Base" then
				esp.label.Text = "Empty Base"
			else
				local nameOnly = string.match(originalText, "^(.-)'s Base$")
				if nameOnly and nameOnly ~= "" then
					if nameOnly == playerDisplayName then
						esp.label.Text = nameOnly .. " (Your Base)"
					else
						esp.label.Text = nameOnly
					end
				else
					esp.label.Text = originalText
				end
			end
		end
	end
	wait(0.5)
end
